runtime: php81

# Environment variables for Google Cloud
env_variables:
  # Database connection (Cloud SQL Unix socket)
  DB_HOST: '/cloudsql/YOUR_PROJECT_ID:YOUR_REGION:YOUR_INSTANCE_NAME'
  DB_NAME: 'your_database_name'
  DB_USER: 'root'
  DB_PASS: 'YOUR_DATABASE_PASSWORD_HERE'  # ⚠️ Replace with actual password
  DB_PORT: '3306'

  # Application URL (update this to your App Engine URL)
  APP_URL: 'https://YOUR_PROJECT_ID.appspot.com'

  # Email settings (Gmail)
  EMAIL_HOST: 'smtp.gmail.com'
  EMAIL_PORT: '587'
  EMAIL_USER: 'your-email@gmail.com'
  EMAIL_PASS: 'YOUR_GMAIL_APP_PASSWORD_HERE'  # ⚠️ Replace with Gmail App Password (16 chars)

  # Cloud Run service URL for receipt rendering
  RECEIPT_RENDERER_URL: 'https://YOUR_CLOUD_RUN_SERVICE_URL'

  # Google Cloud Platform settings
  GCP_PROJECT_ID: 'your-project-id'
  GCP_STORAGE_BUCKET: 'your-bucket-name'

# Handlers for routing
handlers:
  # Serve static files from public directory
  - url: /public/(.*\.(css|js|png|jpg|jpeg|gif|svg|webp|ico|woff|woff2|ttf|eot|pdf))
    static_files: public/\1
    upload: public/.*\.(css|js|png|jpg|jpeg|gif|svg|webp|ico|woff|woff2|ttf|eot|pdf)
    secure: always
    http_headers:
      Cache-Control: 'public, max-age=3600'

  # Serve static files from images directory
  - url: /images/(.*\.(png|jpg|jpeg|gif|svg|webp))
    static_files: images/\1
    upload: images/.*\.(png|jpg|jpeg|gif|svg|webp)
    secure: always
    http_headers:
      Cache-Control: 'public, max-age=3600'

  # Redirect root to index
  - url: /
    script: auto
    secure: always

  # Handle all other requests as PHP scripts
  - url: /.*
    script: auto
    secure: always

# Automatic scaling configuration (stays within free tier)
automatic_scaling:
  target_cpu_utilization: 0.65
  target_throughput_utilization: 0.6
  min_instances: 0
  max_instances: 2
  min_idle_instances: automatic
  max_idle_instances: 1
  min_pending_latency: automatic
  max_pending_latency: 30ms

# Enable Cloud SQL (update with your instance connection name)
beta_settings:
  cloud_sql_instances: YOUR_PROJECT_ID:YOUR_REGION:YOUR_INSTANCE_NAME

# Health check (simple endpoint with no dependencies)
liveness_check:
  path: "/health.php"
  check_interval_sec: 30
  timeout_sec: 4
  failure_threshold: 2
  success_threshold: 2

readiness_check:
  path: "/health.php"
  check_interval_sec: 5
  timeout_sec: 4
  failure_threshold: 2
  success_threshold: 2
  app_start_timeout_sec: 300
