name: Deploy Status

on:
  push:
    branches: [main]

jobs:
  notify-render:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Render Deploy
        id: deploy
        env:
          RENDER_DEPLOY_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
        run: |
          if [ -z "$RENDER_DEPLOY_HOOK" ]; then
            echo "⚠️ RENDER_DEPLOY_HOOK secret not set, skipping deploy trigger"
            echo "ℹ️ Add the secret in GitHub Settings → Secrets → Actions"
            exit 0
          fi
          response=$(curl -s -o /dev/null -w "%{http_code}" -X POST "$RENDER_DEPLOY_HOOK")
          if [ "$response" = "200" ] || [ "$response" = "201" ]; then
            echo "✅ Deploy triggered successfully (HTTP $response)"
            exit 0
          else
            echo "❌ Deploy trigger failed with status: $response"
            exit 1
          fi
        
      - name: Deploy Success
        if: success()
        run: echo "✅ Workflow completed successfully!"
        
      - name: Deploy Failed
        if: failure()
        run: echo "❌ Workflow failed"
